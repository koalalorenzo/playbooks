---
- name: Install NAS packages
  hosts:
  - nas
  - tools
  become: yes
  become_user: root
  become_method: sudo
  gather_facts: no

  tasks:
    - name: "Install packages"
      package:
        state: latest
        name:
          - unattended-upgrades
          - moreutils
          - jq
          - sed
          - gpg
          - make
          - git
          - ncdu
          - podman
          - smartmontools
          - restic

    - name: Checks if restic exists
      stat:
        path: /usr/bin/restic
      register: restic_exists
    - name: Upgrade restic
      command: /usr/bin/restic self-update
